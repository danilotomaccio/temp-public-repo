<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Programmi e Cicli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">

    <main id="app-container" class="p-4 sm:p-8 max-w-7xl mx-auto">
        <!-- I contenuti verranno iniettati qui da JavaScript -->
    </main>

    <script>
        // --- Icone SVG come stringhe ---
        const icons = {
            chevronDown: `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-500 ml-4 transform transition-transform">
                    <path d="m6 9 6 6 6-6" />
                </svg>`,
            calendar: `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-3 text-gray-400">
                    <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
                    <line x1="16" x2="16" y1="2" y2="6" />
                    <line x1="8" x2="8" y1="2" y2="6" />
                    <line x1="3" x2="21" y1="10" y2="10" />
                </svg>`,
            hash: `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-3 text-gray-400">
                    <line x1="4" y1="9" x2="20" y2="9" />
                    <line x1="4" y1="15" x2="20" y2="15" />
                    <line x1="10" y1="3" x2="8" y2="21" />
                    <line x1="16" y1="3" x2="14" y2="21" />
                </svg>`,
            arrowLeft: `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-700">
                    <path d="m12 19-7-7 7-7" />
                    <path d="M19 12H5" />
                </svg>`,
            clock: `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-3 text-gray-400">
                  <circle cx="12" cy="12" r="10" />
                  <polyline points="12 6 12 12 16 14" />
                </svg>`,
            box: `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-3 text-gray-400">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>`
        };

        // --- Dati Mock ---
        const programsData = [
            {
                id: 1,
                name: 'Programma riabilitativo 2024 #0916',
                status: 'In scadenza',
                type: 'Programma',
                accessCode: 'A00234',
                cycles: [
                    {
                        id: 101,
                        name: '1° Ciclo Fisioterapia',
                        sessionsCount: 10,
                        sessionDuration: '45 min',
                        package: 'Fisioterapia Base',
                        startDate: '26 Ago 2024',
                        endDate: '20 Set 2024',
                        status: 'In scadenza',
                        sessions: [
                            { id: 1001, date: '26/08/2024', time: '10:30', endTime: '11:15', terapista: 'Mario Rossi', status: 'Eseguita' },
                            { id: 1002, date: '28/08/2024', time: '11:00', endTime: '11:45', terapista: 'Elena Verdi', status: 'Eseguita' },
                            { id: 1003, date: '30/08/2024', time: '09:00', endTime: '09:45', terapista: 'Mario Rossi', status: 'Programmata' },
                            { id: 1004, date: '02/09/2024', time: '10:30', endTime: '11:15', terapista: 'Elena Verdi', status: 'Da riprogrammare' },
                            { id: 1005, date: '04/09/2024', time: '14:00', endTime: '14:45', terapista: 'Mario Rossi', status: 'Annullata' },
                        ]
                    },
                    {
                        id: 102,
                        name: '2° Ciclo Terapia Occupazionale',
                        sessionsCount: 8,
                        sessionDuration: '60 min',
                        package: 'T.O. Completa',
                        startDate: '23 Set 2024',
                        endDate: '18 Ott 2024',
                        status: 'Da programmare',
                        sessions: []
                    }
                ]
            },
            {
                id: 2,
                name: 'Progetto riabilitativo #02819',
                status: 'In corso',
                type: 'Programma PRI',
                accessCode: 'A00118',
                cycles: [
                     {
                        id: 201,
                        name: 'Ciclo unico Logopedia',
                        sessionsCount: 12,
                        sessionDuration: '50 min',
                        package: 'Logopedia Intensiva',
                        startDate: '01 Set 2024',
                        endDate: '15 Ott 2024',
                        status: 'In corso',
                        sessions: [
                            { id: 2001, date: '01/09/2024', time: '15:00', endTime: '15:50', terapista: 'Laura Bianchi', status: 'Eseguita' },
                        ]
                    }
                ]
            },
             {
                id: 3,
                name: 'Programma Mantenimento #0815',
                status: 'Completato',
                type: 'Programma',
                accessCode: 'A00097',
                cycles: []
            }
        ];

        const appContainer = document.getElementById('app-container');

        // --- Funzioni di Rendering ---

        function getStatusBadge(status) {
            const statusStyles = {
                'In scadenza': 'bg-orange-100 text-orange-800',
                'In corso': 'bg-blue-100 text-blue-800',
                'Da programmare': 'bg-yellow-100 text-yellow-800',
                'Completato': 'bg-green-100 text-green-800',
                'Eseguita': 'bg-green-100 text-green-800',
                'Programmata': 'bg-blue-100 text-blue-800',
                'Da riprogrammare': 'bg-yellow-100 text-yellow-800',
                'Annullata': 'bg-red-100 text-red-800',
            };
            const style = statusStyles[status] || 'bg-gray-100 text-gray-800';
            return `<span class="px-2.5 py-1 text-xs font-semibold rounded-full ${style}">${status}</span>`;
        }

        function renderProgramsListPage() {
            const programsHtml = programsData.map(program => `
                <div class="bg-gray-50 border border-gray-200 rounded-lg mb-4">
                    <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleProgram(${program.id})">
                        <div>
                            <div class="flex items-center">
                                <span class="text-xs font-semibold bg-gray-200 text-gray-700 px-2 py-1 rounded-md mr-3">${program.type}</span>
                                <h2 class="font-semibold text-lg text-gray-900">${program.name}</h2>
                            </div>
                            <div class="flex items-center text-sm text-gray-500 mt-2 space-x-6">
                                <p><span class="font-medium text-gray-600">Codice Accesso:</span> ${program.accessCode}</p>
                                <p><span class="font-medium text-gray-600">Cicli:</span> ${program.cycles.length}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            ${getStatusBadge(program.status)}
                            <div id="chevron-${program.id}">${icons.chevronDown}</div>
                        </div>
                    </div>
                    <div id="cycles-${program.id}" class="p-4 border-t border-gray-200 hidden">
                        ${program.cycles.length > 0 ? program.cycles.map(cycle => `
                            <div onclick="navigateToCycle(${cycle.id})" class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow cursor-pointer space-y-3 mb-4">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-gray-800">${cycle.name}</h3>
                                    ${getStatusBadge(cycle.status)}
                                </div>
                                <div class="flex flex-wrap text-sm text-gray-600">
                                    <div class="flex items-center mr-6 mb-2">
                                        ${icons.hash}
                                        <span>${cycle.sessionsCount} sedute</span>
                                    </div>
                                    <div class="flex items-center mr-6 mb-2">
                                        <div class="flex items-center mr-2">${icons.calendar}</div>
                                        <span>Inizio: ${cycle.startDate}</span>
                                    </div>
                                    <div class="flex items-center mb-2">
                                        <div class="flex items-center mr-2">${icons.calendar}</div>
                                        <span>Fine: ${cycle.endDate}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center text-gray-500 py-4">Nessun ciclo associato a questo programma.</p>'}
                    </div>
                </div>
            `).join('');

            appContainer.innerHTML = `
                <div class="text-sm text-gray-500 mb-4">
                   Dashboard / Pazienti / Trattamenti
                </div>
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Programmi</h1>
                    <button class="bg-red-600 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:bg-red-700 transition-colors">
                        + Nuovo programma
                    </button>
                </div>
                <div>${programsHtml}</div>
            `;
        }
        
        function renderCycleDetailsPage(cycle) {
             const sessionsHtml = cycle.sessions.length > 0 ? cycle.sessions.map(session => `
                <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900">${session.date}</td>
                    <td class="px-6 py-4">${session.time} - ${session.endTime}</td>
                    <td class="px-6 py-4">${session.terapista}</td>
                    <td class="px-6 py-4">${getStatusBadge(session.status)}</td>
                </tr>
            `).join('') : `
                <tr>
                    <td colspan="4" class="text-center py-8 text-gray-500">Nessuna seduta trovata per questo ciclo.</td>
                </tr>
            `;

            appContainer.innerHTML = `
                 <div class="text-sm text-gray-500 mb-4">
                   Dashboard / Pazienti / Trattamenti / ${cycle.name}
                </div>
                <div>
                    <div class="flex items-center mb-6">
                         <button 
                            onclick="navigateToPrograms()"
                            class="p-2 mr-4 rounded-full hover:bg-gray-200 transition-colors"
                            aria-label="Torna indietro">
                            ${icons.arrowLeft}
                        </button>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">${cycle.name}</h1>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white p-4 rounded-lg border border-gray-200 flex items-center">
                            ${icons.hash}
                            <div>
                                <p class="text-sm text-gray-500">N. Sedute</p>
                                <p class="font-bold text-gray-800">${cycle.sessionsCount}</p>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 flex items-center">
                            ${icons.clock}
                            <div>
                                <p class="text-sm text-gray-500">Durata Seduta</p>
                                <p class="font-bold text-gray-800">${cycle.sessionDuration}</p>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 flex items-center col-span-1 md:col-span-2 lg:col-span-1">
                            ${icons.calendar}
                            <div>
                                <p class="text-sm text-gray-500">Periodo</p>
                                <p class="font-bold text-gray-800 text-sm">${cycle.startDate} - ${cycle.endDate}</p>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 flex items-center">
                            ${icons.box}
                            <div>
                                <p class="text-sm text-gray-500">Pacchetto</p>
                                <p class="font-bold text-gray-800">${cycle.package}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="p-4 border-b border-gray-200">
                           <h2 class="text-lg font-semibold text-gray-800">Lista delle sedute programmate</h2>
                        </div>
                        <div class="overflow-x-auto">
                             <table class="w-full text-sm text-left text-gray-600">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Data</th>
                                        <th scope="col" class="px-6 py-3">Orario</th>
                                        <th scope="col" class="px-6 py-3">Terapista</th>
                                        <th scope="col" class="px-6 py-3">Stato</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${sessionsHtml}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Gestione della Navigazione e degli Eventi ---

        function toggleProgram(programId) {
            const cyclesDiv = document.getElementById(`cycles-${programId}`);
            const chevronDiv = document.getElementById(`chevron-${programId}`);
            const chevronSvg = chevronDiv.querySelector('svg');
            
            cyclesDiv.classList.toggle('hidden');
            chevronSvg.classList.toggle('rotate-180');
        }

        function navigateToCycle(cycleId) {
            let selectedCycle = null;
            for (const program of programsData) {
                const foundCycle = program.cycles.find(c => c.id === cycleId);
                if (foundCycle) {
                    selectedCycle = foundCycle;
                    break;
                }
            }

            if (selectedCycle) { // Mostra la pagina anche se non ci sono sedute
                renderCycleDetailsPage(selectedCycle);
            }
        }
        
        function navigateToPrograms() {
            renderProgramsListPage();
        }


        // --- Inizializzazione ---
        document.addEventListener('DOMContentLoaded', renderProgramsListPage);

    </script>
</body>
</html>

